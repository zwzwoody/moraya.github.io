---
title: 代码覆盖率总是搞不懂？5 分钟快速上手 + 常见问题详解
date: 2026-02-20 23:04:38
tags:
  - 代码覆盖率
  - 测试
  - Python
  - Coverage
---

> Streamlit 项目实战案例
>

# 快速入门

代码覆盖率工具用起来其实很简单。首先安装：

```bash
pip install coverage
```

在**测试环境**中启动项目时，只需要加上 `coverage run` 命令就行：

```bash
coverage run --source=. -m streamlit run streamlit_app.py
```

这里有两个关键参数：
- `--source=.`：只统计当前目录下的代码覆盖率，其他目录的文件不计入
- `-m`：告诉 Python 把后面的内容当作模块来运行

接下来，在 Streamlit 界面里跑一跑你的功能（手动点一点或者上自动化测试都行），测试完成后生成报告：

```bash
coverage report -m  # 在终端查看行覆盖率
```

想要更直观的报告？生成 HTML 版本：

```bash
coverage html  # 生成网页版报告，浏览器打开看
```

# 进阶技巧

## 追加模式：不用重复执行

新增了测试用例？不用把之前的用例重新跑一遍。启动项目时加上 `--append` 参数，coverage 会自动追加新的覆盖率数据：

```bash
coverage run --append --source=. -m streamlit run streamlit_app.py
```

## 配置文件 .coveragerc：更多自定义选项

想要更精细地控制覆盖率统计？在项目根目录创建 `.coveragerc` 文件，可以配置：

- 是否统计分支覆盖率
- 开启并行模式（多进程测试必备）
- 忽略特定的文件、函数或代码行
- 选择报告输出格式

## 数据展示：一目了然

报告里会列出每个文件、类、函数的行覆盖率详情：

- **总览页面**：快速了解整体覆盖情况

{% asset_img attachment:1a990bc8-2518-4ff8-84d7-d0c1aebc6667:image.png %}

- **详细页面**：逐行查看哪些代码被测试覆盖到了

{% asset_img attachment:944fff23-3460-4ce2-b364-3aaafdad27b8:image.png %}

# 常见问题

## 1. 覆盖率有哪些类型？

<aside>
💡

- **行覆盖率**：代码行被执行的百分比
- **分支覆盖率**：条件分支（if/else）被覆盖的百分比
- **条件覆盖率**：复杂条件表达式中每个子条件都被测试到的百分比

</aside>

## 2. 覆盖率多少才合适？

<aside>
💡

没有放之四海而皆准的标准，得看你的行业、业务和技术栈。

一般来说：
- **核心业务代码**：行覆盖率 > 90%，分支覆盖率 > 80%
- **一般业务代码**：行覆盖率 70% 左右就差不多了

记住，覆盖率是参考指标，不是 KPI。

</aside>

## 3. 覆盖率 100% 就等于代码没问题？

<aside>
💡

**当然不是！** 覆盖率 100% 只能说明代码被执行过，但：
- 业务逻辑可能还是有 bug
- 边界条件可能没测全
- 性能问题、安全隐患照样可能存在

覆盖率是"必要不充分条件"——高覆盖率不一定没 bug，但低覆盖率一定有风险。

</aside>

## 4. 哪些代码不该计入覆盖率？

<aside>
💡

以下代码可以排除在外：
- 测试代码本身（测试代码不需要被测试）
- 自动生成的代码（比如 protobuf 生成的类）
- 纯配置类（没有业务逻辑）
- 调试/开发专用的工具代码

在 `.coveragerc` 里配置 `omit` 参数就能忽略它们。

</aside>

## 5. 怎么提高覆盖率？

<aside>
💡

两个实用方法：
- **测试驱动开发（TDD）**：先写测试，再写实现，覆盖率自然高
- **补充边界测试**：专门测试极端情况、异常输入

</aside>

## 6. 多进程测试怎么收集覆盖率？

<aside>
💡

**场景**：Jenkins 同时开启多个进程跑自动化测试

**问题**：子进程的覆盖率数据不会自动合并

**解决方案**：
1. 在 `.coveragerc` 中开启 `parallel = True`
2. 测试完成后，用 `coverage combine` 合并所有进程的数据
3. 最后生成报告

这样就能拿到完整的覆盖率统计了。

</aside>
